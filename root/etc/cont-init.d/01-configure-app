#!/usr/bin/with-contenv bash
# shellcheck shell=bash

umask "${UMASK}"

if [[ ! -f "${CONFIG_DIR}/scrutiny.yaml" && ( "${MODE}" == web || "${MODE}" == both ) ]]; then
    echo "Installing default \"scrutiny.yaml\"..."
    cp "${APP_DIR}/scrutiny.yaml" "${CONFIG_DIR}/scrutiny.yaml"
    chown hotio:hotio "${CONFIG_DIR}/scrutiny.yaml"
fi

if [[ ! -f "${CONFIG_DIR}/collector.yaml" && ( "${MODE}" == collector || "${MODE}" == both ) ]]; then
    echo "Installing default \"collector.yaml\"..."
    cp "${APP_DIR}/collector.yaml" "${CONFIG_DIR}/collector.yaml"
    chown hotio:hotio "${CONFIG_DIR}/collector.yaml"
fi

if [[ "${MODE}" == web ]]; then
    rm -rf /etc/services.d/collector
fi

if [[ "${MODE}" == collector ]]; then
    rm -rf /etc/services.d/web
fi
